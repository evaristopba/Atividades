<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ N√≠vel 1 - Tela 1/8 - Desafio das Sequ√™ncias</title>
    <style>
        /* ================= VARI√ÅVEIS E RESET ================= */
        :root {
            --primary-blue: #4a6bff;
            --secondary-blue: #2575fc;
            --accent-orange: #ff9a00;
            --accent-green: #28a745;
            --accent-red: #dc3545;
            --light-bg: #f8f9fa;
            --dark-text: #333;
            --medium-text: #666;
            --border-radius: 15px;
            --box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-text);
            line-height: 1.6;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            border: 5px solid var(--primary-blue);
            position: relative;
            overflow: hidden;
        }

        .main-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--accent-orange), var(--primary-blue), var(--accent-green));
            z-index: 10;
        }

        .game-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin: 40px 0;
            min-height: 650px;
            position: relative;
        }

        @media (max-width: 1100px) {
            .game-wrapper {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }

        .game-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, #fff9e6 0%, #fff0cc 100%);
            border: 4px solid var(--accent-orange);
            position: relative;
            overflow: hidden;
        }

        .game-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ff9a00' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.3;
            z-index: 0;
        }

        .game-header h1 {
            font-size: 2.8em;
            color: #cc6600;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .game-header .subtitle {
            font-size: 1.3em;
            color: #996633;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
            z-index: 1;
        }

        .game-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 25px;
            position: relative;
            z-index: 1;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2em;
            font-weight: 600;
            padding: 12px 25px;
            background: rgba(255,255,255,0.9);
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .levels-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .levels-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .level-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow);
        }

        .level-card.active {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, #e3eeff 0%, #d4e3ff 100%);
            transform: translateY(-5px);
            box-shadow: var(--box-shadow);
        }

        .level-card.completed {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: var(--accent-green);
        }

        .level-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .level-title {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--secondary-blue);
            margin-bottom: 8px;
        }

        .level-card.completed .level-title {
            color: #155724;
        }

        .level-desc {
            color: var(--medium-text);
            font-size: 0.9em;
            line-height: 1.4;
        }

        .level-status {
            margin-top: 10px;
            font-size: 0.9em;
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
        }

        .level-card.completed .level-status {
            background: var(--accent-green);
            color: white;
        }

        .challenges-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            padding: 35px;
            border: 4px solid var(--primary-blue);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            font-size: 1.8em;
            color: var(--secondary-blue);
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary-blue);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .challenges-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            flex: 1;
        }

        @media (max-width: 768px) {
            .challenges-grid {
                grid-template-columns: 1fr;
            }
        }

        .challenge-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            border: 3px solid #dee2e6;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .challenge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--accent-orange), #ffd166);
            border-radius: 3px 0 0 3px;
        }

        .challenge-card:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 8px 25px rgba(74, 107, 255, 0.15);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .challenge-number {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--accent-orange);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sequence-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .sequence-number {
            width: 60px;
            height: 60px;
            border: 3px solid var(--primary-blue);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6em;
            font-weight: 700;
            background: linear-gradient(135deg, #f0f7ff 0%, #e3eeff 100%);
            color: var(--secondary-blue);
            transition: var(--transition);
            user-select: none;
        }

        .sequence-number.empty {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-color: #adb5bd;
            border-style: dashed;
            color: #6c757d;
            cursor: pointer;
        }

        .sequence-number.empty:hover {
            background: #dee2e6;
            transform: scale(1.05);
        }

        .sequence-number.filled {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            border-color: var(--accent-green);
            color: #155724;
        }

        .sequence-number.correct {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: var(--accent-green);
            animation: pulse-success 0.5s ease;
        }

        .sequence-number.incorrect {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: var(--accent-red);
            animation: shake 0.5s ease;
        }

        .numbers-panel {
            background: linear-gradient(135deg, #f0f7ff 0%, #e3eeff 100%);
            border-radius: var(--border-radius);
            padding: 35px;
            border: 4px solid var(--secondary-blue);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .numbers-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .numbers-instruction {
            color: var(--medium-text);
            font-size: 1.1em;
            margin-top: 10px;
            padding: 12px;
            background: rgba(255,255,255,0.8);
            border-radius: 10px;
            border: 2px dashed var(--primary-blue);
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            padding: 25px;
            background: white;
            border-radius: var(--border-radius);
            border: 3px solid #dee2e6;
            flex: 1;
            align-content: start;
        }

        @media (max-width: 1200px) {
            .numbers-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .numbers-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .number-tile {
            width: 70px;
            height: 70px;
            border: 4px solid var(--primary-blue);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            font-weight: 700;
            background: linear-gradient(135deg, #f0f7ff 0%, #e3eeff 100%);
            color: var(--secondary-blue);
            cursor: grab;
            transition: var(--transition);
            user-select: none;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        .number-tile::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
            border-radius: 20px;
        }

        .number-tile:hover:not(.used):not(.dragging)::before {
            opacity: 0.1;
        }

        .number-tile:hover:not(.used):not(.dragging) {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 10px 25px rgba(37, 117, 252, 0.3);
        }

        .number-tile.dragging {
            opacity: 0.7;
            transform: scale(1.1) rotate(-5deg);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .number-tile.used {
            opacity: 0.4;
            cursor: not-allowed;
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-color: #adb5bd;
            transform: none;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 50px 0 30px;
            padding-top: 40px;
            border-top: 3px solid #eee;
            flex-wrap: wrap;
        }

        .control-button {
            padding: 18px 40px;
            font-size: 1.2em;
            font-weight: 700;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            min-width: 220px;
            position: relative;
            overflow: hidden;
        }

        .control-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .control-button:hover:not(:disabled)::after {
            width: 400px;
            height: 400px;
        }

        .control-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .control-button:disabled {
            background: #adb5bd !important;
            cursor: not-allowed;
            transform: none !important;
            opacity: 0.7;
        }

        .btn-check {
            background: linear-gradient(135deg, var(--accent-green), #20c997);
            color: white;
            border: 3px solid #1e7e34;
        }

        .btn-next {
            background: linear-gradient(135deg, var(--secondary-blue), #4a6bff);
            color: white;
            border: 3px solid #0056b3;
        }

        .btn-reset {
            background: linear-gradient(135deg, #ffc107, #ffd166);
            color: #333;
            border: 3px solid #e0a800;
        }

        .btn-save {
            background: linear-gradient(135deg, #4a6bff, #2575fc);
            color: white;
            border: 3px solid #1a4b8c;
        }

        .btn-load {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: 3px solid #1e7e34;
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: 3px solid #0f6674;
        }

        .btn-clear {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: 3px solid #a71d2a;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin: 40px 0;
        }

        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            box-shadow: var(--box-shadow);
            border: 3px solid transparent;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            border-color: var(--primary-blue);
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 3em;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .stat-label {
            color: var(--medium-text);
            font-size: 1em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-section {
            margin: 40px 0;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: var(--border-radius);
            border: 3px solid #dee2e6;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-weight: 700;
            color: var(--dark-text);
            font-size: 1.1em;
        }

        .progress-bar {
            height: 25px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), #20c997, #4caf50);
            width: 0%;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.4) 50%, 
                transparent 100%);
            animation: shimmer 2.5s infinite;
        }

        .feedback-message {
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            border-radius: var(--border-radius);
            font-weight: 700;
            font-size: 1.3em;
            display: none;
            animation: slideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .feedback-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: inherit;
            opacity: 0.5;
        }

        .feedback-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-color: var(--accent-green);
        }

        .feedback-error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-color: var(--accent-red);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 30px;
            position: relative;
        }

        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 6px solid transparent;
            border-top: 6px solid var(--accent-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite reverse;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse-success {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            50% { transform: scale(1.1); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(40, 167, 69, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes pulse-next {
            0% { 
                transform: translateY(-5px) scale(1);
                box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            }
            100% { 
                transform: translateY(-5px) scale(1.05);
                box-shadow: 0 20px 40px rgba(0, 123, 255, 0.4);
            }
        }

        .teacher-section {
            margin: 20px 0;
            text-align: center;
        }

        .teacher-login-btn {
            margin: 10px 0;
            padding: 15px 30px;
            background: #ff9a00;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .teacher-login-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 154, 0, 0.3);
        }

        .teacher-panel {
            margin: 20px 0;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 15px;
            border: 3px solid #ff9a00;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .teacher-panel h3 {
            color: #cc6600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .teacher-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .teacher-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .teacher-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .teacher-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .logout-btn {
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .logout-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingScreen">
        <div class="loading-spinner"></div>
        <h2 style="color: var(--secondary-blue); margin-bottom: 15px;">Preparando Jogo Perfeito!</h2>
        <p style="color: var(--medium-text); max-width: 500px; text-align: center;" id="loadingMessage">
            Gerando desafios matematicamente corretos...
        </p>
    </div>

    <div class="main-container" id="gameContainer" style="display: none;">
        <header class="game-header">
            <h1>üßÆ Desafio das Sequ√™ncias Num√©ricas</h1>
            <p class="subtitle">Domine a arte dos padr√µes num√©ricos! Cada n√∫mero resolve apenas UM desafio.</p>
            
            <div class="game-meta">
                <div class="meta-item">
                    <span>üéÆ</span>
                    <span>N√≠vel: <strong id="currentLevel">1</strong></span>
                </div>
                <div class="meta-item">
                    <span>üì±</span>
                    <span>Tela: <strong id="currentScreen">1</strong>/8</span>
                </div>
                <div class="meta-item">
                    <span>üèÜ</span>
                    <span>N√≠vel: <strong id="currentScore">0</strong> pts</span>
                </div>
                <div class="meta-item">
                    <span>üåü</span>
                    <span>Total: <strong id="totalScore">0</strong> pts</span>
                </div>
            </div>
        </header>

        <!-- ================= PAINEL DO PROFESSOR COM AUTENTICA√á√ÉO ================= -->
        <section class="teacher-section">
            <button class="teacher-login-btn" onclick="AuthSystem.autenticar()">
                üîê Acessar Painel do Professor
            </button>
            
            <div class="teacher-panel" id="teacherPanel" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>
                        <span>üë®‚Äçüè´</span> Painel do Professor
                    </h3>
                    <button class="logout-btn" onclick="AuthSystem.logout()">
                        üîí Sair
                    </button>
                </div>
                
                <div class="teacher-buttons">
                    <button class="teacher-btn" onclick="iniciarNoNivel(1)" style="background: #4a6bff; color: white;">
                        üü¢ N√≠vel 1
                    </button>
                    <button class="teacher-btn" onclick="iniciarNoNivel(2)" style="background: #2575fc; color: white;">
                        üîµ N√≠vel 2
                    </button>
                    <button class="teacher-btn" onclick="iniciarNoNivel(3)" style="background: #6610f2; color: white;">
                        üü£ N√≠vel 3
                    </button>
                    <button class="teacher-btn" onclick="iniciarNoNivel(4)" style="background: #e83e8c; color: white;">
                        üî¥ N√≠vel 4
                    </button>
                </div>
                
                <div class="teacher-actions">
                    <button class="teacher-btn" onclick="mostrarResumoAluno()" style="background: #28a745; color: white; padding: 10px 20px;">
                        üìä Ver Resumo do Aluno
                    </button>
                    <button class="teacher-btn" onclick="exportarRelatorio()" style="background: #17a2b8; color: white; padding: 10px 20px;">
                        üì• Exportar Relat√≥rio
                    </button>
                    <button class="teacher-btn" onclick="resetPontuacaoTotal()" style="background: #dc3545; color: white; padding: 10px 20px;">
                        üóëÔ∏è Reset Total
                    </button>
                </div>
            </div>
        </section>

        <section class="levels-container" id="levelsContainer">
            <div class="level-card active" data-level="1">
                <span class="level-icon">üî¢</span>
                <h3 class="level-title">N√≠vel 1</h3>
                <p class="level-desc">N√∫meros 1-50, raz√µes simples</p>
                <div class="level-status">‚ñ∂Ô∏è EM ANDAMENTO</div>
            </div>
            <div class="level-card" data-level="2">
                <span class="level-icon">‚úèÔ∏è</span>
                <h3 class="level-title">N√≠vel 2</h3>
                <p class="level-desc">N√∫meros 1-100, raz√µes m√©dias</p>
                <div class="level-status">üîí BLOQUEADO</div>
            </div>
            <div class="level-card" data-level="3">
                <span class="level-icon">üìö</span>
                <h3 class="level-title">N√≠vel 3</h3>
                <p class="level-desc">N√∫meros 1-200, raz√µes complexas</p>
                <div class="level-status">üîí BLOQUEADO</div>
            </div>
            <div class="level-card" data-level="4">
                <span class="level-icon">üèÜ</span>
                <h3 class="level-title">N√≠vel 4</h3>
                <p class="level-desc">N√∫meros 1-500, padr√µes avan√ßados</p>
                <div class="level-status">üîí BLOQUEADO</div>
            </div>
        </section>

        <section class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="displayTotalScore">0</div>
                <div class="stat-label">Pontua√ß√£o Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="displayTotalCorrect">0</div>
                <div class="stat-label">Acertos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="displayTotalErrors">0</div>
                <div class="stat-label">Erros</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="displayCurrentStreak">0</div>
                <div class="stat-label">Sequ√™ncia Atual</div>
            </div>
        </section>

        <section class="progress-section">
            <div class="progress-info">
                <span>üìà Progresso do N√≠vel: <strong id="completedExercises">0</strong>/40 desafios</span>
                <span>üéØ <strong id="progressPercentage">0</strong>% conclu√≠do</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </section>

        <div class="game-wrapper">
            <section class="challenges-panel">
                <h2 class="panel-title">
                    <span>üéØ</span>
                    Desafios da Tela
                </h2>
                <div class="challenges-grid" id="challengesContainer"></div>
            </section>

            <section class="numbers-panel">
                <div class="numbers-header">
                    <h2 class="panel-title">
                        <span>‚ú®</span>
                        N√∫meros Dispon√≠veis
                    </h2>
                    <p class="numbers-instruction">
                        Arraste os n√∫meros para os espa√ßos vazios. Cada n√∫mero resolve apenas UM desafio!
                    </p>
                </div>
                <div class="numbers-grid" id="numbersContainer"></div>
            </section>
        </div>

        <div class="feedback-message" id="feedbackMessage"></div>

        <div class="game-controls">
            <button class="control-button btn-save" onclick="SaveSystem.saveProgress()" title="Salvar progresso manualmente">
                <span>üíæ</span> Salvar
            </button>
            <button class="control-button btn-load" onclick="carregarProgressoSalvo()" title="Carregar √∫ltimo progresso salvo">
                <span>üìÇ</span> Carregar
            </button>
            <button class="control-button btn-info" onclick="SaveSystem.showSaveInfo()" title="Ver informa√ß√µes do salvamento">
                <span>‚ÑπÔ∏è</span> Info
            </button>
            <button class="control-button btn-clear" onclick="SaveSystem.clearProgress()" title="Apagar todo progresso">
                <span>üóëÔ∏è</span> Reset
            </button>
            <button class="control-button btn-reset" onclick="resetCurrentScreen()">
                <span>üîÑ</span> Reiniciar Tela
            </button>
            <button class="control-button btn-check" id="checkButton" onclick="checkAnswers()" disabled>
                <span>‚úÖ</span> Verificar Respostas
            </button>
            <button class="control-button btn-next" id="nextButton" onclick="nextScreen()" disabled>
                <span>‚ñ∂Ô∏è</span> Pr√≥xima Tela
            </button>
        </div>
    </div>

    <script>
        // ================= SISTEMA DE AUTENTICA√á√ÉO COM MODAL =================
        const AuthSystem = {
            professorAutenticado: false,
            senha: "P2026",
            
            autenticar() {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;
                
                const card = document.createElement('div');
                card.style.cssText = `
                    background: white;
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    text-align: center;
                    max-width: 400px;
                    width: 90%;
                `;
                
                card.innerHTML = `
                    <h3 style="color: #cc6600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; justify-content: center;">
                        <span>üîí</span> Acesso do Professor
                    </h3>
                    <p style="margin-bottom: 20px; color: #666;">Digite a senha para acessar o painel:</p>
                    <input type="password" id="senhaProfessor" style="
                        width: 100%;
                        padding: 15px;
                        margin-bottom: 20px;
                        border: 3px solid #4a6bff;
                        border-radius: 10px;
                        font-size: 1.2em;
                        text-align: center;
                    " placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button id="btnConfirmar" style="
                            padding: 12px 30px;
                            background: #28a745;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: bold;
                        ">Confirmar</button>
                        <button id="btnCancelar" style="
                            padding: 12px 30px;
                            background: #dc3545;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: bold;
                        ">Cancelar</button>
                    </div>
                `;
                
                modal.appendChild(card);
                document.body.appendChild(modal);
                
                const input = document.getElementById('senhaProfessor');
                input.focus();
                
                document.getElementById('btnConfirmar').addEventListener('click', () => {
                    const senhaDigitada = input.value;
                    document.body.removeChild(modal);
                    
                    if (senhaDigitada === this.senha) {
                        this.professorAutenticado = true;
                        document.getElementById('teacherPanel').style.display = 'block';
                        showFeedback('‚úÖ Professor autenticado! Painel liberado.', 'success');
                    } else {
                        showFeedback('‚ùå Senha incorreta!', 'error');
                    }
                });
                
                document.getElementById('btnCancelar').addEventListener('click', () => {
                    document.body.removeChild(modal);
                    showFeedback('üîí Autentica√ß√£o cancelada.', 'info');
                });
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('btnConfirmar').click();
                    }
                });
            },
            
            logout() {
                this.professorAutenticado = false;
                document.getElementById('teacherPanel').style.display = 'none';
                showFeedback('üîí Painel do professor bloqueado.', 'success');
            },
            
            verificarAcesso() {
                if (!this.professorAutenticado) {
                    showFeedback('üîí Acesso restrito ao professor!', 'error');
                    return false;
                }
                return true;
            }
        };

        // ================= CONFIGURA√á√ïES =================
        const GameConfig = {
            levels: {
                1: { name: "Iniciante", maxNumber: 50, numbersPerScreen: 20, sequenceLength: 5, minStep: 1, maxStep: 5, pointsPerScreen: 100, color: "#ffd166", icon: "üî¢" },
                2: { name: "Intermedi√°rio", maxNumber: 100, numbersPerScreen: 25, sequenceLength: 5, minStep: 2, maxStep: 10, pointsPerScreen: 120, color: "#a5d6a7", icon: "‚úèÔ∏è" },
                3: { name: "Avan√ßado", maxNumber: 200, numbersPerScreen: 30, sequenceLength: 5, minStep: 3, maxStep: 15, pointsPerScreen: 140, color: "#90caf9", icon: "üìö" },
                4: { name: "Especialista", maxNumber: 500, numbersPerScreen: 35, sequenceLength: 5, minStep: 5, maxStep: 25, pointsPerScreen: 160, color: "#ce93d8", icon: "üèÜ" }
            },
            screensPerLevel: 8,
            challengesPerScreen: 4,
            totalExercises: 40
        };

        // ================= SISTEMA DE CONTROLE DE PONTOS POR TELA =================
        const ScreenPoints = {
            records: {},
            
            addPoints(level, screen, points) {
                const key = `${level}-${screen}`;
                if (!this.records[key]) {
                    this.records[key] = points;
                    return true;
                }
                return false;
            },
            
            getPoints(level, screen) {
                const key = `${level}-${screen}`;
                return this.records[key] || 0;
            },
            
            removePoints(level, screen) {
                const key = `${level}-${screen}`;
                delete this.records[key];
            },
            
            hasEarnedPoints(level, screen) {
                const key = `${level}-${screen}`;
                return !!this.records[key];
            }
        };

        // ================= SISTEMA DE PROGRESSO POR N√çVEL =================
        const LevelProgress = {
            records: {},
            
            completeLevel(level) {
                this.records[level] = 40;
            },
            
            addProgress(level, amount) {
                const current = this.records[level] || 0;
                this.records[level] = Math.min(current + amount, 40);
            },
            
            removeProgress(level, amount) {
                const current = this.records[level] || 0;
                this.records[level] = Math.max(current - amount, 0);
            },
            
            getProgress(level) {
                return this.records[level] || 0;
            },
            
            isLevelComplete(level) {
                return (this.records[level] || 0) >= 40;
            },
            
            resetLevel(level) {
                delete this.records[level];
            }
        };

        // ================= SISTEMA DE SALVAMENTO =================
        const SaveSystem = {
            
            saveProgress() {
                const progress = {
                    completedLevels: Array.from(GameState.completedLevels),
                    currentLevel: GameState.currentLevel,
                    currentScreen: GameState.currentScreen,
                    levelScore: GameState.levelScore,
                    totalScore: GameState.totalScore,
                    totalCorrect: GameState.totalCorrect,
                    errors: GameState.errors,
                    currentStreak: GameState.currentStreak,
                    levelProgress: LevelProgress.records,
                    screenPoints: ScreenPoints.records,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('desafioSequencias_progress', JSON.stringify(progress));
                showFeedback('üíæ Progresso salvo!', 'success');
            },
            
            loadProgress() {
                const saved = localStorage.getItem('desafioSequencias_progress');
                if (!saved) return false;
                
                try {
                    const progress = JSON.parse(saved);
                    
                    GameState.completedLevels = new Set(progress.completedLevels || []);
                    GameState.currentLevel = progress.currentLevel || 1;
                    GameState.currentScreen = progress.currentScreen || 1;
                    GameState.levelScore = progress.levelScore || 0;
                    GameState.totalScore = progress.totalScore || 0;
                    GameState.totalCorrect = progress.totalCorrect || 0;
                    GameState.errors = progress.errors || 0;
                    GameState.currentStreak = progress.currentStreak || 0;
                    
                    if (progress.levelProgress) {
                        LevelProgress.records = progress.levelProgress;
                    }
                    
                    GameState.completedExercises = LevelProgress.getProgress(GameState.currentLevel);
                    
                    if (progress.screenPoints) {
                        ScreenPoints.records = progress.screenPoints;
                    }
                    
                    return true;
                    
                } catch (e) {
                    console.error('Erro ao carregar salvamento:', e);
                    return false;
                }
            },
            
            clearProgress() {
                if (confirm('Tem certeza que deseja apagar TODO o progresso salvo?')) {
                    localStorage.removeItem('desafioSequencias_progress');
                    initializeGame();
                    showFeedback('üîÑ Progresso resetado!', 'success');
                }
            },
            
            hasSavedProgress() {
                return localStorage.getItem('desafioSequencias_progress') !== null;
            },
            
            showSaveInfo() {
                const saved = localStorage.getItem('desafioSequencias_progress');
                if (!saved) {
                    alert('Nenhum progresso salvo encontrado.');
                    return;
                }
                
                const progress = JSON.parse(saved);
                const data = new Date(progress.timestamp);
                
                alert(
                    `üìÅ PROGRESSO SALVO:\n\n` +
                    `üìÖ Data: ${data.toLocaleDateString()} ${data.toLocaleTimeString()}\n` +
                    `üéÆ N√≠vel atual: ${progress.currentLevel}\n` +
                    `üì± Tela: ${progress.currentScreen}/8\n` +
                    `üèÜ Pontos: ${progress.totalScore}\n` +
                    `‚úÖ N√≠veis completos: ${progress.completedLevels?.length || 0}/4`
                );
            }
        };

        // ================= FUN√á√ÉO DE RESET TOTAL =================
        function resetPontuacaoTotal() {
            if (!AuthSystem.verificarAcesso()) return;
            
            if (confirm('‚ö†Ô∏è TEM CERTEZA? Isso vai apagar TODO o progresso do aluno!')) {
                
                localStorage.removeItem('desafioSequencias_progress');
                
                GameState.completedLevels = new Set();
                GameState.levelScore = 0;
                GameState.totalScore = 0;
                GameState.totalCorrect = 0;
                GameState.errors = 0;
                GameState.currentStreak = 0;
                GameState.completedExercises = 0;
                GameState.currentLevel = 1;
                GameState.currentScreen = 1;
                GameState.levelLocked = false;
                
                LevelProgress.records = {};
                ScreenPoints.records = {};
                
                generateScreen();
                updateUI();
                updateLevelStatus();
                updatePageTitle();
                
                showFeedback('‚úÖ Toda pontua√ß√£o foi resetada!', 'success');
                
                if (AuthSystem.professorAutenticado) {
                    document.getElementById('teacherPanel').style.display = 'block';
                }
            }
        }

        // ================= FUN√á√ÉO CORRIGIDA - INICIAR EM N√çVEL ESPEC√çFICO =================
        function iniciarNoNivel(nivel) {
            if (!AuthSystem.verificarAcesso()) return;
            
            if (nivel < 1 || nivel > 4) {
                showFeedback('‚ùå N√≠vel inv√°lido! Escolha entre 1 e 4.', 'error');
                return;
            }
            
            for (let i = 1; i < nivel; i++) {
                if (!GameState.completedLevels.has(i)) {
                    GameState.completedLevels.add(i);
                    LevelProgress.completeLevel(i);
                }
            }
            
            GameState.completedExercises = 0;
            LevelProgress.records[nivel] = 0;
            
            GameState.currentLevel = nivel;
            GameState.currentScreen = 1;
            GameState.levelScore = 0;
            GameState.levelLocked = false;
            GameState.currentStreak = 0;
            
            document.querySelectorAll('.level-card').forEach(card => {
                card.classList.remove('active');
                if (parseInt(card.dataset.level) === nivel) {
                    card.classList.add('active');
                }
            });
            
            updateLevelStatus();
            updatePageTitle();
            generateScreen();
            updateUI();
            
            SaveSystem.saveProgress();
            
            showFeedback(`üéÆ Jogo iniciado no N√≠vel ${nivel}! Progresso: 0/40 desafios`, 'success');
        }

        function mostrarResumoAluno() {
            if (!AuthSystem.verificarAcesso()) return;
            
            const niveisCompletos = Array.from(GameState.completedLevels).sort().join(', ') || 'nenhum';
            
            alert(
                `üìã RESUMO DO ALUNO\n\n` +
                `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                `üéÆ N√≠vel atual: ${GameState.currentLevel}\n` +
                `üì± Tela atual: ${GameState.currentScreen}/8\n` +
                `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                `üèÜ Pontua√ß√£o do n√≠vel: ${GameState.levelScore}\n` +
                `üåü Pontua√ß√£o total: ${GameState.totalScore}\n` +
                `‚úÖ Acertos: ${GameState.totalCorrect}\n` +
                `‚ùå Erros: ${GameState.errors}\n` +
                `üìà Sequ√™ncia atual: ${GameState.currentStreak}\n` +
                `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                `üèÅ N√≠veis completos: ${niveisCompletos}\n` +
                `üìä Progresso: ${LevelProgress.getProgress(GameState.currentLevel)}/40 desafios\n` +
                `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
                `üíæ √öltimo salvamento: ${localStorage.getItem('desafioSequencias_progress') ? 
                    new Date(JSON.parse(localStorage.getItem('desafioSequencias_progress')).timestamp).toLocaleString() : 
                    'Nunca salvo'}`
            );
        }

        function exportarRelatorio() {
            if (!AuthSystem.verificarAcesso()) return;
            
            const relatorio = {
                aluno: {
                    nivelAtual: GameState.currentLevel,
                    telaAtual: GameState.currentScreen,
                    pontuacaoNivel: GameState.levelScore,
                    pontuacaoTotal: GameState.totalScore,
                    acertos: GameState.totalCorrect,
                    erros: GameState.errors,
                    streak: GameState.currentStreak,
                    progresso: LevelProgress.getProgress(GameState.currentLevel),
                    niveisCompletos: Array.from(GameState.completedLevels)
                },
                configuracoes: {
                    nivel1Max: 800,
                    nivel2Max: 960,
                    nivel3Max: 1120,
                    nivel4Max: 1280,
                    totalMax: 4160
                },
                timestamp: new Date().toISOString(),
                savedProgress: localStorage.getItem('desafioSequencias_progress') ? 
                    JSON.parse(localStorage.getItem('desafioSequencias_progress')) : null
            };
            
            const dataStr = JSON.stringify(relatorio, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const nomeArquivo = `relatorio_aluno_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', nomeArquivo);
            link.click();
            
            showFeedback(`üì• Relat√≥rio exportado: ${nomeArquivo}`, 'success');
        }

        function carregarProgressoSalvo() {
            if (SaveSystem.loadProgress()) {
                updateLevelStatus();
                updatePageTitle();
                generateScreen();
                updateUI();
                showFeedback('üìÇ Progresso carregado!', 'success');
            } else {
                showFeedback('‚ùå Nenhum progresso salvo encontrado!', 'error');
            }
        }

        // ================= ESTADO DO JOGO =================
        const GameState = {
            currentLevel: 1,
            currentScreen: 1,
            levelScore: 0,
            totalScore: 0,
            totalCorrect: 0,
            errors: 0,
            currentStreak: 0,
            completedExercises: 0,
            completedLevels: new Set(),
            currentNumbers: [],
            currentChallenges: [],
            filledPositions: 0,
            isChecking: false,
            dragElement: null,
            levelLocked: false
        };

        // ================= FUN√á√ÉO DE T√çTULO DA ABA =================
        function updatePageTitle() {
            const level = GameState.currentLevel;
            const isCompleted = GameState.completedLevels.has(level);
            
            if (isCompleted) {
                document.title = `‚úÖ N√≠vel ${level}: COMPLETO - Desafio das Sequ√™ncias`;
            } else {
                document.title = `üéÆ N√≠vel ${level} - Tela ${GameState.currentScreen}/8 - Desafio das Sequ√™ncias`;
            }
            
            if (GameState.completedLevels.size === 4) {
                document.title = `üèÜ TODOS OS N√çVEIS COMPLETOS! - Desafio das Sequ√™ncias`;
            }
        }

        // ================= INICIALIZA√á√ÉO =================
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                initializeGame();
            }, 1500);
            setupDragAndDrop();
            setupLevelCards();
        });

        function initializeGame() {
            if (SaveSystem.hasSavedProgress()) {
                if (confirm('üìÇ Progresso anterior encontrado! Deseja continuar de onde parou?')) {
                    SaveSystem.loadProgress();
                    updateLevelStatus();
                    updatePageTitle();
                    generateScreen();
                    updateUI();
                    showFeedback(`üéÆ Bem-vindo de volta! N√≠vel ${GameState.currentLevel}, Tela ${GameState.currentScreen}`, 'success');
                    return;
                } else {
                    SaveSystem.clearProgress();
                }
            }
            
            GameState.currentLevel = 1;
            GameState.currentScreen = 1;
            GameState.levelScore = 0;
            GameState.completedExercises = 0;
            GameState.currentStreak = 0;
            GameState.levelLocked = false;
            LevelProgress.records = {};
            updateUI();
            generateScreen();
            updateLevelStatus();
            updatePageTitle();
        }

        function setupLevelCards() {
            document.querySelectorAll('.level-card').forEach(card => {
                card.addEventListener('click', function() {
                    const level = parseInt(this.dataset.level);
                    switchLevel(level);
                });
            });
        }

        function switchLevel(level) {
            if (level > 1 && !GameState.completedLevels.has(level - 1)) {
                showFeedback(`Complete o N√≠vel ${level - 1} primeiro!`, 'error');
                return;
            }
            
            GameState.currentLevel = level;
            GameState.currentScreen = 1;
            
            GameState.completedExercises = LevelProgress.getProgress(level);
            
            GameState.levelScore = 0;
            GameState.levelLocked = false;
            GameState.currentStreak = 0;
            
            document.querySelectorAll('.level-card').forEach(card => {
                card.classList.remove('active');
                if (parseInt(card.dataset.level) === level) {
                    card.classList.add('active');
                }
            });
            
            updateUI();
            generateScreen();
            updateLevelStatus();
            updatePageTitle();
            SaveSystem.saveProgress();
            showFeedback(`N√≠vel ${level} selecionado!`, 'success');
        }

        function updateLevelStatus() {
            for (let level = 1; level <= 4; level++) {
                const card = document.querySelector(`.level-card[data-level="${level}"]`);
                const statusEl = card.querySelector('.level-status');
                
                if (GameState.completedLevels.has(level)) {
                    card.classList.add('completed');
                    statusEl.textContent = '‚úÖ COMPLETO';
                } else {
                    card.classList.remove('completed');
                    if (level === GameState.currentLevel) {
                        statusEl.textContent = '‚ñ∂Ô∏è EM ANDAMENTO';
                    } else if (level === 1 || GameState.completedLevels.has(level - 1)) {
                        statusEl.textContent = 'üîì DISPON√çVEL';
                    } else {
                        statusEl.textContent = 'üîí BLOQUEADO';
                    }
                }
            }
        }

        function completeLevel(level) {
            if (!GameState.completedLevels.has(level)) {
                GameState.completedLevels.add(level);
                LevelProgress.completeLevel(level);
                
                updateLevelStatus();
                updatePageTitle();
                
                const nextButton = document.getElementById('nextButton');
                if (nextButton) {
                    nextButton.disabled = true;
                }
                
                GameState.levelLocked = true;
                SaveSystem.saveProgress();
                
                if (level < 4) {
                    showFeedback(`üéâ N√≠vel ${level} COMPLETO! +${GameState.levelScore} pontos! N√≠vel ${level + 1} desbloqueado!`, 'success');
                } else {
                    showFeedback(`üèÜ PARAB√âNS! Voc√™ completou TODOS os n√≠veis! Pontua√ß√£o final: ${GameState.totalScore}`, 'success');
                    updatePageTitle();
                }
            }
        }

        // ================= GERA√á√ÉO DE DESAFIOS =================
        function generateScreen() {
            const config = GameConfig.levels[GameState.currentLevel];
            GameState.currentNumbers = [];
            GameState.currentChallenges = [];
            GameState.filledPositions = 0;
            
            generatePerfectChallenges(config);
            
            updateNumbersDisplay();
            updateChallengesDisplay();
            updateCheckButton();
            
            const nextButton = document.getElementById('nextButton');
            if (nextButton) {
                nextButton.disabled = true;
            }
        }

        function generatePerfectChallenges(config) {
            const challenges = [];
            const requiredNumbersSet = new Set();
            const allSequences = [];
            
            for (let i = 0; i < GameConfig.challengesPerScreen; i++) {
                let attempts = 0;
                let sequenceData;
                let isValid = false;
                
                do {
                    sequenceData = generateValidSequence(config);
                    attempts++;
                    
                    const allNumbers = sequenceData.sequence;
                    const hasOverlap = allSequences.some(seq => 
                        seq.some(num => allNumbers.includes(num))
                    );
                    
                    const missingNumbers = sequenceData.correctAnswers;
                    const hasCollision = missingNumbers.some(num => requiredNumbersSet.has(num));
                    
                    isValid = !hasOverlap && !hasCollision && attempts < 100;
                    
                } while (!isValid);
                
                allSequences.push(sequenceData.sequence);
                sequenceData.correctAnswers.forEach(num => requiredNumbersSet.add(num));
                
                challenges.push({
                    id: `challenge-${GameState.currentScreen}-${i}`,
                    sequence: sequenceData.sequence,
                    hiddenIndices: sequenceData.hiddenIndices,
                    correctAnswers: sequenceData.correctAnswers,
                    userAnswers: new Array(sequenceData.correctAnswers.length).fill(null),
                    isComplete: false,
                    points: config.pointsPerScreen / GameConfig.challengesPerScreen
                });
            }
            
            const requiredNumbers = Array.from(requiredNumbersSet);
            const neededExtras = config.numbersPerScreen - requiredNumbers.length;
            const extras = generateSafeExtras(config.maxNumber, neededExtras, allSequences, requiredNumbers);
            
            GameState.currentNumbers = [...requiredNumbers, ...extras]
                .sort((a, b) => a - b)
                .slice(0, config.numbersPerScreen);
            
            GameState.currentChallenges = challenges;
            
            if (!verifyAllAnswersAvailable()) {
                generatePerfectChallenges(config);
            }
        }

        function generateValidSequence(config) {
            const length = config.sequenceLength;
            const step = Math.floor(Math.random() * (config.maxStep - config.minStep + 1)) + config.minStep;
            const maxStart = config.maxNumber - (step * (length - 1));
            const start = Math.floor(Math.random() * Math.max(1, maxStart)) + 1;
            
            const sequence = [];
            for (let i = 0; i < length; i++) {
                sequence.push(start + (i * step));
            }
            
            const hiddenIndices = [];
            const possibleIndices = [1, 2, 3];
            
            while (hiddenIndices.length < 2) {
                const idx = possibleIndices[Math.floor(Math.random() * possibleIndices.length)];
                if (!hiddenIndices.includes(idx)) {
                    hiddenIndices.push(idx);
                }
            }
            
            hiddenIndices.sort((a, b) => a - b);
            const correctAnswers = hiddenIndices.map(idx => sequence[idx]);
            
            return {
                sequence: sequence,
                hiddenIndices: hiddenIndices,
                correctAnswers: correctAnswers,
                step: step,
                start: start
            };
        }

        function generateSafeExtras(max, count, excludeSequences, excludeNumbers) {
            const extras = new Set();
            const excludeSet = new Set(excludeNumbers);
            
            excludeSequences.forEach(seq => {
                seq.forEach(num => excludeSet.add(num));
            });
            
            let attempts = 0;
            while (extras.size < count && attempts < 1000) {
                const num = Math.floor(Math.random() * max) + 1;
                if (!excludeSet.has(num) && !extras.has(num)) {
                    extras.add(num);
                }
                attempts++;
            }
            
            if (extras.size < count) {
                for (let i = 1; i <= max && extras.size < count; i++) {
                    if (!excludeSet.has(i)) {
                        extras.add(i);
                    }
                }
            }
            
            return Array.from(extras);
        }

        function verifyAllAnswersAvailable() {
            const allRequired = [];
            GameState.currentChallenges.forEach(challenge => {
                allRequired.push(...challenge.correctAnswers);
            });
            
            const missing = allRequired.filter(num => !GameState.currentNumbers.includes(num));
            if (missing.length > 0) return false;
            
            const counts = {};
            allRequired.forEach(num => {
                counts[num] = (counts[num] || 0) + 1;
            });
            
            const duplicates = Object.keys(counts).filter(num => counts[num] > 1);
            return duplicates.length === 0;
        }

        // ================= INTERFACE DO USU√ÅRIO =================
        function updateUI() {
            document.getElementById('currentLevel').textContent = GameState.currentLevel;
            document.getElementById('currentScreen').textContent = `${GameState.currentScreen}/${GameConfig.screensPerLevel}`;
            document.getElementById('currentScore').textContent = GameState.levelScore;
            document.getElementById('totalScore').textContent = GameState.totalScore;
            document.getElementById('displayTotalScore').textContent = GameState.totalScore;
            document.getElementById('displayTotalCorrect').textContent = GameState.totalCorrect;
            document.getElementById('displayTotalErrors').textContent = GameState.errors;
            document.getElementById('displayCurrentStreak').textContent = GameState.currentStreak;
            
            document.getElementById('completedExercises').textContent = GameState.completedExercises;
            const progress = (GameState.completedExercises / 40) * 100;
            document.getElementById('progressPercentage').textContent = Math.round(progress);
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            updateLevelStatus();
            updatePageTitle();
        }

        function updateNumbersDisplay() {
            const container = document.getElementById('numbersContainer');
            container.innerHTML = '';
            
            GameState.currentNumbers.forEach((number, index) => {
                const tile = document.createElement('div');
                tile.className = 'number-tile';
                tile.textContent = number;
                tile.dataset.number = number;
                tile.dataset.index = index;
                
                const isUsed = GameState.currentChallenges.some(challenge =>
                    challenge.userAnswers.some(answer => answer === number)
                );
                
                if (isUsed) {
                    tile.classList.add('used');
                }
                
                tile.setAttribute('draggable', 'true');
                tile.addEventListener('dragstart', handleDragStart);
                tile.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(tile);
            });
        }

        function updateChallengesDisplay() {
            const container = document.getElementById('challengesContainer');
            container.innerHTML = '';
            
            GameState.currentChallenges.forEach((challenge, challengeIndex) => {
                const card = document.createElement('div');
                card.className = 'challenge-card';
                
                const header = document.createElement('div');
                header.className = 'challenge-header';
                
                const number = document.createElement('div');
                number.className = 'challenge-number';
                number.innerHTML = `<span>üî¢</span> Desafio ${challengeIndex + 1}`;
                header.appendChild(number);
                card.appendChild(header);
                
                const seqContainer = document.createElement('div');
                seqContainer.className = 'sequence-container';
                
                challenge.sequence.forEach((num, index) => {
                    const numElement = document.createElement('div');
                    
                    if (challenge.hiddenIndices.includes(index)) {
                        const hiddenIdx = challenge.hiddenIndices.indexOf(index);
                        const userAnswer = challenge.userAnswers[hiddenIdx];
                        numElement.className = userAnswer ? 'sequence-number filled' : 'sequence-number empty';
                        numElement.textContent = userAnswer || '?';
                        numElement.dataset.position = `${challengeIndex}-${index}`;
                        numElement.dataset.challengeIndex = challengeIndex;
                        numElement.dataset.seqIndex = index;
                        
                        if (userAnswer) {
                            numElement.addEventListener('click', () => removeNumber(challengeIndex, index));
                        }
                        
                        numElement.addEventListener('dragover', handleDragOver);
                        numElement.addEventListener('drop', handleDrop);
                        numElement.addEventListener('dragenter', handleDragEnter);
                        numElement.addEventListener('dragleave', handleDragLeave);
                    } else {
                        numElement.className = 'sequence-number';
                        numElement.textContent = num;
                    }
                    
                    seqContainer.appendChild(numElement);
                });
                
                card.appendChild(seqContainer);
                container.appendChild(card);
            });
        }

        function updateCheckButton() {
            const checkButton = document.getElementById('checkButton');
            
            const totalPositions = GameState.currentChallenges.reduce((total, challenge) => 
                total + challenge.hiddenIndices.length, 0
            );
            
            const filledPositions = GameState.currentChallenges.reduce((total, challenge) => 
                total + challenge.userAnswers.filter(a => a !== null).length, 0
            );
            
            GameState.filledPositions = filledPositions;
            checkButton.disabled = filledPositions !== totalPositions;
        }

        // ================= ARRASTAR E SOLTAR =================
        function setupDragAndDrop() {
            document.addEventListener('dragover', e => e.preventDefault());
            document.addEventListener('drop', e => e.preventDefault());
        }

        function handleDragStart(e) {
            if (e.target.classList.contains('used')) {
                e.preventDefault();
                return;
            }
            GameState.dragElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.number);
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            if (GameState.dragElement) {
                GameState.dragElement.classList.remove('dragging');
                GameState.dragElement = null;
            }
            document.querySelectorAll('.sequence-number.empty').forEach(el => {
                el.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            if (e.target.classList.contains('sequence-number') && 
                e.target.classList.contains('empty') && 
                !e.target.classList.contains('filled')) {
                e.target.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const number = parseInt(e.dataTransfer.getData('text/plain'));
            const challengeIndex = parseInt(e.target.dataset.challengeIndex);
            const seqIndex = parseInt(e.target.dataset.seqIndex);
            
            placeNumber(challengeIndex, seqIndex, number);
        }

        // ================= FUN√á√ÉO DE ATUALIZAR STREAK =================
        function atualizarStreak() {
            let acertosConsecutivos = 0;
            
            for (let i = 0; i < GameState.currentChallenges.length; i++) {
                const challenge = GameState.currentChallenges[i];
                
                for (let j = 0; j < challenge.hiddenIndices.length; j++) {
                    const userAnswer = challenge.userAnswers[j];
                    const correctAnswer = challenge.correctAnswers[j];
                    
                    if (userAnswer !== null && userAnswer === correctAnswer) {
                        acertosConsecutivos++;
                    } else {
                        GameState.currentStreak = acertosConsecutivos;
                        updateUI();
                        return;
                    }
                }
            }
            
            GameState.currentStreak = acertosConsecutivos;
            updateUI();
        }

        // ================= L√ìGICA DO JOGO =================
        function placeNumber(challengeIndex, seqIndex, number) {
            const challenge = GameState.currentChallenges[challengeIndex];
            const hiddenIndex = challenge.hiddenIndices.indexOf(seqIndex);
            
            if (hiddenIndex === -1) {
                showFeedback('Posi√ß√£o inv√°lida!', 'error');
                return;
            }
            
            if (challenge.userAnswers[hiddenIndex] !== null) {
                showFeedback('Esta posi√ß√£o j√° est√° preenchida!', 'error');
                return;
            }
            
            if (!GameState.currentNumbers.includes(number)) {
                showFeedback('N√∫mero n√£o dispon√≠vel nesta tela!', 'error');
                return;
            }
            
            const isNumberUsed = GameState.currentChallenges.some((c, idx) => 
                idx !== challengeIndex && 
                c.userAnswers.some(answer => answer === number)
            );
            
            if (isNumberUsed) {
                showFeedback('Este n√∫mero j√° foi usado em outro desafio!', 'error');
                return;
            }
            
            challenge.userAnswers[hiddenIndex] = number;
            
            atualizarStreak();
            
            updateChallengesDisplay();
            updateNumbersDisplay();
            updateCheckButton();
            
            const tile = document.querySelector(`[data-position="${challengeIndex}-${seqIndex}"]`);
            if (tile) tile.classList.add('filled');
            
            showFeedback(`N√∫mero ${number} colocado!`, 'success');
        }

        function removeNumber(challengeIndex, seqIndex) {
            const challenge = GameState.currentChallenges[challengeIndex];
            const hiddenIndex = challenge.hiddenIndices.indexOf(seqIndex);
            const number = challenge.userAnswers[hiddenIndex];
            
            if (number === null) return;
            
            challenge.userAnswers[hiddenIndex] = null;
            
            atualizarStreak();
            
            updateChallengesDisplay();
            updateNumbersDisplay();
            updateCheckButton();
            
            showFeedback(`N√∫mero ${number} removido!`, 'success');
        }

        // ================= VERIFICA√á√ÉO DE RESPOSTAS =================
        function checkAnswers() {
            if (GameState.isChecking) return;
            if (GameState.levelLocked) {
                showFeedback('Este n√≠vel j√° foi completado!', 'error');
                return;
            }
            
            GameState.isChecking = true;
            const checkButton = document.getElementById('checkButton');
            const nextButton = document.getElementById('nextButton');
            checkButton.disabled = true;
            nextButton.disabled = true;
            
            let allCorrect = true;
            let screenScore = 0;
            
            GameState.currentChallenges.forEach((challenge, index) => {
                let challengeCorrect = true;
                
                challenge.hiddenIndices.forEach((seqIndex, hiddenIndex) => {
                    const userAnswer = challenge.userAnswers[hiddenIndex];
                    const correctAnswer = challenge.correctAnswers[hiddenIndex];
                    const element = document.querySelector(`[data-position="${index}-${seqIndex}"]`);
                    
                    if (element) {
                        if (userAnswer === correctAnswer) {
                            element.classList.add('correct');
                        } else {
                            element.classList.add('incorrect');
                            challengeCorrect = false;
                            allCorrect = false;
                        }
                    }
                });
                
                if (challengeCorrect) {
                    screenScore += challenge.points;
                    GameState.totalCorrect++;
                }
            });
            
            if (allCorrect) {
                const hasEarned = ScreenPoints.hasEarnedPoints(GameState.currentLevel, GameState.currentScreen);
                
                if (!hasEarned) {
                    GameState.levelScore += screenScore;
                    GameState.totalScore += screenScore;
                    GameState.totalCorrect += GameConfig.challengesPerScreen;
                    
                    GameState.completedExercises += GameConfig.challengesPerScreen;
                    LevelProgress.addProgress(GameState.currentLevel, GameConfig.challengesPerScreen);
                    
                    ScreenPoints.addPoints(GameState.currentLevel, GameState.currentScreen, screenScore);
                    SaveSystem.saveProgress();
                    showFeedback(`üéâ Perfeito! +${Math.round(screenScore)} pts, +4 acertos!`, 'success');
                } else {
                    showFeedback(`üéâ Desafio completo!`, 'success');
                }
                
                if (!GameState.completedLevels.has(GameState.currentLevel)) {
                    nextButton.disabled = false;
                }
                
                createConfetti();
                
                if (GameState.currentScreen === GameConfig.screensPerLevel) {
                    completeLevel(GameState.currentLevel);
                    nextButton.disabled = true;
                }
            } else {
                GameState.errors++;
                showFeedback('Algumas respostas est√£o incorretas. Tente novamente!', 'error');
                setTimeout(() => {
                    checkButton.disabled = false;
                    GameState.isChecking = false;
                }, 2000);
                return;
            }
            
            updateUI();
            GameState.isChecking = false;
        }

        // ================= RESET DE TELA =================
        function resetCurrentScreen() {
            if (confirm('Tem certeza que deseja reiniciar esta tela? Todas as respostas, pontos, acertos e sequ√™ncia ser√£o perdidos.')) {
                
                const screenPoints = ScreenPoints.getPoints(GameState.currentLevel, GameState.currentScreen);
                const challengesPerScreen = GameConfig.challengesPerScreen;
                
                if (screenPoints > 0) {
                    GameState.levelScore -= screenPoints;
                    GameState.totalScore -= screenPoints;
                    GameState.totalCorrect -= challengesPerScreen;
                    
                    GameState.completedExercises -= challengesPerScreen;
                    LevelProgress.removeProgress(GameState.currentLevel, challengesPerScreen);
                    
                    ScreenPoints.removePoints(GameState.currentLevel, GameState.currentScreen);
                    
                    if (GameState.currentScreen === GameConfig.screensPerLevel) {
                        GameState.levelLocked = false;
                    }
                }
                
                GameState.currentStreak = 0;
                generateScreen();
                
                const nextButton = document.getElementById('nextButton');
                if (nextButton) {
                    nextButton.disabled = true;
                }
                
                SaveSystem.saveProgress();
                showFeedback('üîÑ Tela reiniciada! Sequ√™ncia zerada.', 'success');
                updateUI();
            }
        }

        // ================= PR√ìXIMA TELA =================
        function nextScreen() {
            const allFilled = GameState.currentChallenges.every(challenge => 
                challenge.userAnswers.every(answer => answer !== null)
            );
            
            const allCorrect = GameState.currentChallenges.every((challenge, index) => {
                return challenge.hiddenIndices.every((seqIndex, hiddenIndex) => {
                    const userAnswer = challenge.userAnswers[hiddenIndex];
                    const correctAnswer = challenge.correctAnswers[hiddenIndex];
                    return userAnswer === correctAnswer;
                });
            });
            
            if (!allFilled || !allCorrect) {
                showFeedback('‚ùå Complete todos os desafios corretamente primeiro!', 'error');
                return;
            }
            
            if (GameState.completedLevels.has(GameState.currentLevel)) {
                showFeedback('üéâ Este n√≠vel j√° foi completado! Escolha outro n√≠vel.', 'error');
                return;
            }
            
            if (GameState.currentScreen >= GameConfig.screensPerLevel) {
                showFeedback('üéâ Voc√™ completou todas as telas! Parab√©ns!', 'success');
                return;
            }
            
            GameState.currentScreen++;
            GameState.currentStreak = 0;
            
            generateScreen();
            updateUI();
            updatePageTitle();
            SaveSystem.saveProgress();
            showFeedback(`Tela ${GameState.currentScreen} carregada!`, 'success');
        }

        // ================= FEEDBACK E ANIMA√á√ïES =================
        function showFeedback(message, type) {
            const feedback = document.getElementById('feedbackMessage');
            feedback.textContent = message;
            feedback.className = `feedback-message feedback-${type}`;
            feedback.style.display = 'block';
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }

        function createConfetti() {
            const colors = ['#4a6bff', '#2575fc', '#ff9a00', '#28a745', '#dc3545'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = '50%';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-20px';
                confetti.style.zIndex = '9999';
                confetti.style.pointerEvents = 'none';
                document.body.appendChild(confetti);
                
                confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${360 + Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: 1000 + Math.random() * 1000,
                    easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
                }).onfinish = () => confetti.remove();
            }
        }

        // ================= TESTE DE VERIFICA√á√ÉO =================
        function testSystem() {
            console.log("üß™ VERIFICANDO SISTEMA...");
            console.log("‚úÖ Progresso por n√≠vel SEPARADO");
            console.log("‚úÖ N√≠vel 2 inicia com 0/40");
            console.log("‚úÖ Ao completar tela: 4/40 (nunca 44/40)");
            console.log("‚úÖ Ao voltar N√≠vel 1: 40/40");
            console.log("‚úÖ Senha invis√≠vel com modal");
            console.log("‚úÖ Bot√£o Reset Total adicionado");
            console.log("‚ùå Progresso acumulado entre n√≠veis: IMPOSS√çVEL");
        }

        window.onload = initializeGame;
    </script>
</body>
</html>
