<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabuada Interativa de Divis√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5bc0de; --secondary: #31b0d5; --accent: #f0ad4e;
            --light: #e0f7fa; --drag-bg: #f2fafd; --drop-zone-bg: #f9f9f9;
            --correct-bg: #d9edf7; --dark: #34495e; --success: #28a745;
            --danger: #dc3545; --border-color: #e0e0e0; --incorrect-bg: #f8d7da;
            --light-text: #6c7a89;
        }
        
        * { box-sizing: border-box; font-family: 'Open Sans', sans-serif; }
        
        body {
            background-color: #f7f9fc; margin: 0; padding: 20px;
            color: var(--dark); line-height: 1.6; display: flex;
            justify-content: center; align-items: flex-start; min-height: 100vh;
        }
        
        .tabuada-container {
            max-width: 800px; /* Layout mais compacto */
            width: 100%; margin: 0 auto; background: white;
            border-radius: 12px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            overflow: hidden; transition: all 0.3s ease;
        }
        
        header {
            background-color: var(--primary); color: white; padding: 20px;
            text-align: center; border-bottom: 4px solid var(--accent);
            position: relative; transition: background-color 0.4s ease, border-color 0.4s ease;
        }
        
        header h1 {
            font-family: 'Poppins', sans-serif; margin: 0;
            font-size: 2.0em;
            letter-spacing: 0.8px; text-shadow: 1px 1px 3px rgba(0,0,0,0.15);
        }
        
        header p { font-size: 1em; margin-top: 5px; opacity: 0.9; }

        .report-button {
            position: absolute; top: 15px; right: 15px;
            background-color: var(--accent); color: var(--dark); border: none;
            padding: 8px 16px; border-radius: 25px; cursor: pointer;
            font-size: 0.9em; font-weight: 600; transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .report-button:hover {
            background-color: #ffc169; transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .tab-navigation {
            display: flex; flex-wrap: wrap; background-color: var(--secondary);
            border-bottom: 3px solid var(--accent); justify-content: center;
            padding: 5px; transition: background-color 0.4s ease, border-color 0.4s ease;
        }
        
        .tab-button {
            flex-grow: 1; flex-basis: auto; min-width: 65px;
            padding: 10px 0; text-align: center; color: white;
            font-size: 0.85em; font-weight: 600; cursor: pointer;
            transition: background-color 0.3s ease, border-bottom 0.3s ease, transform 0.2s ease;
            border-bottom: 3px solid transparent; margin: 2px;
            border-radius: 6px; position: relative; overflow: hidden;
        }
        
        .tab-button::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255,255,255,0.1); transform: scaleX(0); transform-origin: bottom right; transition: transform 0.3s ease-out; z-index: 0; }
        .tab-button.active::before { transform: scaleX(1); transform-origin: bottom left; }
        .tab-button.active { background-color: var(--primary); border-bottom: 3px solid var(--accent); box-shadow: inset 0 0 10px rgba(0,0,0,0.1); transform: translateY(-1px); }
        .tab-button:not(.active):hover { background-color: var(--primary); filter: brightness(1.1); transform: translateY(-1px); }
        .tab-button span { position: relative; z-index: 1; }
        
        .tab-content-area { padding: 20px; background-color: #fcfcfc; }
        .tabuada-block { display: none; }
        .tabuada-block.active { display: block; animation: fadeIn 0.5s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .tabuada-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px dashed var(--border-color); flex-wrap: wrap; gap: 12px; }
        .tabuada-header > div { flex-grow: 1; min-width: 120px; }
        .tabuada-header h2 { font-family: 'Poppins', sans-serif; color: var(--primary); margin: 0; font-size: 1.7em; flex-basis: 100%; text-align: center; }
        .tabuada-header .score-area { font-size: 1em; font-weight: 600; color: var(--light-text); flex-grow: 0; white-space: nowrap; display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
        .tabuada-header .score-area span { color: var(--dark); font-weight: bold; }
        .tabuada-header button { background-color: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s ease; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1); flex-grow: 0; white-space: nowrap; }
        .tabuada-header button:hover { background-color: #5a6268; transform: translateY(-1px); }
        .bncc-info { font-size: 0.8em; color: var(--light-text); margin-top: 8px; border-top: 1px solid #f0f0f0; padding-top: 8px; line-height: 1.3; flex-basis: 100%; text-align: center; }
        .bncc-info strong { color: var(--dark); }

        .main-practice-area { display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-start; min-height: 380px; }
        .problems-grid { flex: 4; display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; }
        .problem-item { background-color: #ffffff; border: 1px solid #e8e8e8; border-radius: 8px; padding: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; font-weight: 600; color: var(--dark); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); transition: all 0.2s ease; }
        .problem-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .problem-item span { margin-right: 8px; }
        .drop-zone { width: 55px; height: 32px; border: 2px dashed var(--primary); border-radius: 6px; background-color: var(--drop-zone-bg); display: flex; align-items: center; justify-content: center; font-size: 1em; color: var(--light-text); transition: all 0.2s ease; position: relative; overflow: hidden; font-weight: 500; }
        .drop-zone.hover { background-color: var(--light); border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(var(--primary), 0.2); }
        .drop-zone.correct { background-color: var(--correct-bg); border-color: var(--success); color: var(--success); border-style: solid; font-weight: bold; }
        .drop-zone.incorrect { background-color: var(--incorrect-bg); border-color: var(--danger); color: var(--danger); animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-6px); } 40%, 80% { transform: translateX(6px); } }
        .draggable-numbers-pool { flex: 1.5; background-color: var(--light); border: 1px solid var(--primary); border-radius: 10px; padding: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(45px, 1fr)); gap: 8px; justify-content: center; align-content: flex-start; box-shadow: inset 0 0 8px rgba(0,0,0,0.08); }
        .draggable-number { background-color: var(--accent); color: var(--dark); padding: 10px 15px; border-radius: 6px; cursor: grab; font-size: 1em; font-weight: 700; transition: all 0.2s ease; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); user-select: none; text-align: center; }
        .draggable-number:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); background-color: #ffc977; }
        .draggable-number:active { cursor: grabbing; transform: scale(0.95); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); }
        footer { background-color: var(--dark); color: white; text-align: center; padding: 15px 25px; font-size: 0.85em; border-top: 4px solid var(--accent); margin-top: 25px; transition: border-color 0.4s ease; border-radius: 0 0 12px 12px; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .modal.is-active { display: flex; }
        .modal-content { background-color: #fff; margin: auto; padding: 30px 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 550px; text-align: center; position: relative; transform: translateY(-30px); animation: fadeInScale 0.4s ease-out forwards; border: 1px solid #f0f0f0; }
        .overall-summary-content { text-align: left; margin-top: 25px; max-height: 450px; overflow-y: auto; padding-right: 15px; }
        .overall-summary-content h4 { color: var(--secondary); margin-top: 20px; margin-bottom: 12px; font-size: 1.3em; border-bottom: 1px solid #eee; padding-bottom: 8px; font-family: 'Poppins', sans-serif; }
        .overall-summary-content ul { list-style: none; padding: 0; margin: 0; }
        .overall-summary-content ul li { padding: 10px 0; border-bottom: 1px dotted #f5f5f5; font-size: 1em; color: var(--light-text); }
        .overall-summary-content ul li:last-child { border-bottom: none; }
        .summary-overall-totals { margin-top: 30px; padding-top: 20px; border-top: 2px solid var(--primary); font-size: 1.2em; font-weight: bold; color: var(--primary); }
        .modal-content .close-button { color: #aaa; position: absolute; top: 15px; right: 20px; font-size: 32px; font-weight: bold; cursor: pointer; transition: color 0.3s ease, transform 0.2s ease; }
        .modal-content .close-button:hover, .modal-content .close-button:focus { color: var(--dark); transform: scale(1.1); }
        .modal-content h3 { font-family: 'Poppins', sans-serif; color: var(--primary); font-size: 2em; margin-top: 0; margin-bottom: 20px; }
        .modal-content p { font-size: 1.15em; color: var(--dark); margin-bottom: 30px; }
        .modal-actions { display: flex; justify-content: center; gap: 20px; margin-top: 25px; }
        .modal-actions button { padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-size: 1.05em; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.15); letter-spacing: 0.5px; }
        #redo-tabuada-button { background-color: var(--danger); color: white; }
        #redo-tabuada-button:hover { background-color: #e04433; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        #continue-tabuada-button, #reset-all-tabuadas-button { background-color: var(--primary); color: white; }
        #continue-tabuada-button:hover, #reset-all-tabuadas-button:hover { background-color: var(--secondary); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.85) translateY(-30px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        
        @media (max-width: 768px) {
            .main-practice-area { flex-direction: column; min-height: auto; }
            .problems-grid, .draggable-numbers-pool { flex: auto; width: 100%; }
            .draggable-numbers-pool { margin-top: 15px; }
            .problems-grid { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); }
            .tabuada-header { flex-direction: column; align-items: center; gap: 10px; }
            .report-button { position: static; width: 100%; margin-bottom: 10px; }
        }

        @media (max-width: 600px) {
            body { padding: 10px; } .tabuada-container { border-radius: 8px; }
            header { padding: 18px 10px; } header h1 { font-size: 1.8em; } header p { font-size: 0.95em; }
            .tab-button { flex-basis: 30%; min-width: 50px; font-size: 0.78em; padding: 7px 0; }
            .tab-content-area { padding: 15px; }
            .problems-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; }
            .problem-item { font-size: 1.1em; padding: 10px; }
            .drop-zone { width: 50px; height: 30px; font-size: 0.95em; }
            .draggable-numbers-pool { grid-template-columns: repeat(auto-fit, minmax(40px, 1fr)); gap: 6px; }
            .draggable-number { padding: 8px 12px; font-size: 0.9em; }
            .bncc-info { font-size: 0.75em; } footer { padding: 12px 15px; font-size: 0.8em; }
            .modal-content { padding: 25px 30px; } .modal-content h3 { font-size: 1.6em; } .modal-content p { font-size: 1em; }
            .modal-actions { flex-direction: column; gap: 10px; } .modal-actions button { width: 100%; padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="tabuada-container">
        <header id="main-header">
            <h1>Tabuada Interativa de Divis√£o</h1>
            <p>Arrasta e Solta para Encontrar o Quociente!</p>
            <button class="report-button" onclick="showOverallSummaryModal()">Relat√≥rio Geral</button>
        </header>

        <nav class="tab-navigation" id="tabNavigation"></nav>

        <div class="tab-content-area" id="tabContentArea"></div>

        <footer>
            <p>¬© 2024 Tabuada Inteligente. Todos os direitos reservados.</p>
        </footer>
    </div>

    <!-- HTML RESTAURADO -->
    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeCompletionModal()">√ó</span>
            <h3 id="completion-message-title"></h3>
            <p id="completion-message-text"></p>
            <div class="modal-actions">
                <button id="redo-tabuada-button" onclick="handleRedoClick()">Refazer Tabuada</button>
                <button id="continue-tabuada-button" onclick="handleContinueClick()">Pr√≥xima Tabuada</button>
            </div>
        </div>
    </div>
    <div id="overall-summary-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeOverallSummaryModal()">√ó</span>
            <h3>Relat√≥rio Geral de Desempenho (Divis√£o)</h3>
            <div class="overall-summary-content" id="overall-summary-content"></div>
            <div class="modal-actions">
                <button id="reset-all-tabuadas-button" onclick="resetAllTabuadas()">Reiniciar Todas as Tabuadas</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT RESTAURADO -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabuadaData = {};
            const tabuadaScores = {};
            const tabuadaErrors = {};

            let currentTabuadaNum = 1;
            let totalOverallErrors = 0;
            let totalOverallScore = 0;

            const MAX_ALLOWED_ERRORS = 4;

            for (let i = 1; i <= 10; i++) {
                tabuadaData[i] = {
                    problems: [],
                    bncc: { code: `EF03MA08`, description: `Resolver e elaborar problemas de divis√£o de um n√∫mero natural por outro (at√© 10 000 por 10), com os significados de reparti√ß√£o equitativa e medida...` }
                };
                for (let j = 1; j <= 10; j++) {
                    tabuadaData[i].problems.push({ problem: `${i * j} √∑ ${i}`, answer: j, id: `div-problem-${i}-${j}`, solved: false, userAnswer: null });
                }
                tabuadaScores[i] = 0;
                tabuadaErrors[i] = 0;
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function generateDraggableNumbersPool() {
                const numbers = new Set();
                for (let j = 1; j <= 10; j++) { numbers.add(j); }
                const sortedNumbers = Array.from(numbers).sort((a, b) => a - b);
                let html = '';
                sortedNumbers.forEach(num => { html += `<div class="draggable-number" draggable="true" id="drag-div-${num}">${num}</div>`; });
                return html;
            }
            
            function calculateOverallScore() { return Object.values(tabuadaScores).reduce((a, b) => a + b, 0); }
            function calculateOverallErrors() { return Object.values(tabuadaErrors).reduce((a, b) => a + b, 0); }

            function renderTabNavigation() {
                const navContainer = document.getElementById('tabNavigation');
                if (!navContainer) return;
                navContainer.innerHTML = '';
                for (let i = 1; i <= 10; i++) {
                    const button = document.createElement('div');
                    button.classList.add('tab-button');
                    button.innerHTML = `<span>Div. por ${i}</span>`;
                    button.dataset.tabuadaNum = i;
                    button.onclick = () => showTabuada(i);
                    navContainer.appendChild(button);
                }
            }

            function renderTabuadaContent(tabuadaNum) {
                const problems = [...tabuadaData[tabuadaNum].problems];
                shuffleArray(problems);
                const bnccInfo = tabuadaData[tabuadaNum].bncc;
                let htmlContent = `<div class="tabuada-header"> ... </div> <div class="main-practice-area"> <div class="problems-grid">`;
                problems.forEach(item => {
                    htmlContent += `<div class="problem-item" data-problem-id="${item.id}"><span>${item.problem} =</span><div class="drop-zone" data-correct-answer="${item.answer}" ondragover="allowDrop(event)" ondrop="drop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)"></div></div>`;
                });
                htmlContent += `</div><div class="draggable-numbers-pool">${generateDraggableNumbersPool()}</div></div>`;
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                const header = tempDiv.querySelector('.tabuada-header');
                header.innerHTML = `<div><h2>Divis√£o por ${tabuadaNum}</h2><div class="bncc-info"><strong>BNCC:</strong> (${bnccInfo.code}) ${bnccInfo.description}</div></div><div class="score-area"><span>Pontua√ß√£o: <span id="score-div-${tabuadaNum}">${tabuadaScores[tabuadaNum]}</span>/10</span><span>Erros: <span id="errors-div-${tabuadaNum}">${tabuadaErrors[tabuadaNum]}</span></span><span>Total Geral Acertos: <span id="total-overall-score">${calculateOverallScore()}</span>/100</span><span>Total Geral Erros: <span id="total-overall-errors">${calculateOverallErrors()}</span></span></div><button onclick="resetTabuada(${tabuadaNum})">Resetar Divis√£o</button>`;
                return tempDiv.innerHTML;
            }

            window.showTabuada = (tabuadaNum) => {
                currentTabuadaNum = tabuadaNum;
                const tabContentArea = document.getElementById('tabContentArea');
                if (!tabContentArea) return;
                tabContentArea.innerHTML = '';
                const tabuadaBlock = document.createElement('div');
                tabuadaBlock.classList.add('tabuada-block', 'active');
                tabuadaBlock.id = `tabuada-block-div-${tabuadaNum}`;
                tabuadaBlock.innerHTML = renderTabuadaContent(tabuadaNum);
                tabContentArea.appendChild(tabuadaBlock);
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active');
                    if (parseInt(button.dataset.tabuadaNum) === tabuadaNum) button.classList.add('active');
                });
                tabuadaBlock.querySelectorAll('.draggable-number').forEach(draggable => draggable.addEventListener('dragstart', dragStart));
                updateDroppedStates(tabuadaNum);
                updateOverallScoreDisplay();
                updateErrorDisplays();
            }

            let draggedElementData = null;
            function dragStart(event) { draggedElementData = event.target.textContent; event.dataTransfer.setData('text/plain', draggedElementData); event.dataTransfer.effectAllowed = 'copy'; }
            window.allowDrop = (event) => { event.preventDefault(); event.dataTransfer.dropEffect = 'copy'; }
            window.dragEnter = (event) => { event.preventDefault(); if (event.target.classList.contains('drop-zone') && !event.target.classList.contains('correct')) event.target.classList.add('hover'); }
            window.dragLeave = (event) => { if (event.target.classList.contains('drop-zone')) event.target.classList.remove('hover'); }

            window.drop = (event) => {
                event.preventDefault();
                const dropZone = event.target;
                dropZone.classList.remove('hover');
                if (dropZone.classList.contains('correct')) return;
                const droppedValue = parseInt(event.dataTransfer.getData('text/plain'));
                const correctAnswer = parseInt(dropZone.dataset.correctAnswer);
                const problemId = dropZone.closest('.problem-item')?.dataset.problemId;
                const problem = tabuadaData[currentTabuadaNum].problems.find(p => p.id === problemId);
                if (droppedValue === correctAnswer) {
                    dropZone.textContent = droppedValue;
                    dropZone.classList.remove('incorrect');
                    dropZone.classList.add('correct');
                    if (problem && !problem.solved) {
                        problem.solved = true; problem.userAnswer = droppedValue;
                        tabuadaScores[currentTabuadaNum]++; totalOverallScore++;
                        document.getElementById(`score-div-${currentTabuadaNum}`).textContent = tabuadaScores[currentTabuadaNum];
                        updateOverallScoreDisplay();
                    }
                    dropZone.ondrop = null; dropZone.ondragover = null; dropZone.ondragenter = null; dropZone.ondragleave = null;
                    if (tabuadaScores[currentTabuadaNum] === 10) showCompletionMessage(currentTabuadaNum);
                } else {
                    dropZone.textContent = droppedValue;
                    dropZone.classList.add('incorrect');
                    tabuadaErrors[currentTabuadaNum]++; totalOverallErrors++;
                    updateErrorDisplays();
                    setTimeout(() => { dropZone.textContent = ''; dropZone.classList.remove('incorrect'); }, 700);
                }
            }

            function updateDroppedStates(tabuadaNum) {
                const problems = tabuadaData[tabuadaNum].problems;
                const block = document.getElementById(`tabuada-block-div-${tabuadaNum}`);
                if (!block) return;
                problems.forEach(problem => {
                    if (problem.solved) {
                        const dropZone = block.querySelector(`.problem-item[data-problem-id="${problem.id}"] .drop-zone`);
                        if (dropZone) {
                            dropZone.textContent = problem.userAnswer;
                            dropZone.classList.add('correct');
                            dropZone.ondrop = null; dropZone.ondragover = null; dropZone.ondragenter = null; dropZone.ondragleave = null;
                        }
                    }
                });
                const scoreEl = document.getElementById(`score-div-${tabuadaNum}`);
                const errorEl = document.getElementById(`errors-div-${tabuadaNum}`);
                if (scoreEl) scoreEl.textContent = tabuadaScores[tabuadaNum];
                if (errorEl) errorEl.textContent = tabuadaErrors[tabuadaNum];
            }

            function updateOverallScoreDisplay() { const el = document.getElementById(`total-overall-score`); if(el) el.textContent = calculateOverallScore(); }
            function updateErrorDisplays() {
                const currentEl = document.getElementById(`errors-div-${currentTabuadaNum}`); if(currentEl) currentEl.textContent = tabuadaErrors[currentTabuadaNum];
                const overallEl = document.getElementById(`total-overall-errors`); if(overallEl) overallEl.textContent = calculateOverallErrors();
            }

            window.resetTabuada = (tabuadaNum) => {
                if (!confirm(`Tem certeza que deseja reiniciar a divis√£o por ${tabuadaNum}?`)) return;
                tabuadaScores[tabuadaNum] = 0; tabuadaErrors[tabuadaNum] = 0;
                tabuadaData[tabuadaNum].problems.forEach(p => { p.solved = false; p.userAnswer = null; });
                totalOverallScore = calculateOverallScore(); totalOverallErrors = calculateOverallErrors();
                showTabuada(tabuadaNum);
            }
            
            function showCompletionMessage(tabuadaNum) {
                const modal = document.getElementById('completion-modal'), title = document.getElementById('completion-message-title'), text = document.getElementById('completion-message-text'), redo = document.getElementById('redo-tabuada-button'), cont = document.getElementById('continue-tabuada-button');
                const errors = tabuadaErrors[tabuadaNum];
                redo.style.display = 'inline-block'; cont.textContent = 'Pr√≥xima Tabuada';
                let mTitle = '', mText = `Voc√™ completou a Divis√£o por ${tabuadaNum}!`;
                if (errors > MAX_ALLOWED_ERRORS) { mTitle = 'Aten√ß√£o!'; mText += `<br>Voc√™ teve ${errors} erros. √â recomendado refaz√™-la!`; cont.textContent = 'Refazer Mais Tarde'; } else {
                    redo.style.display = 'none';
                    if (errors === 0) { mTitle = 'Magn√≠fico! üéâ'; mText += `<br>NENHUM erro! Impec√°vel!`; }
                    else if (errors <= 2) { mTitle = 'Excelente! ‚ú®'; mText += `<br>Voc√™ teve apenas ${errors} erro(s). Quase perfeito!`; }
                    else { mTitle = 'Muito Bem! üëç'; mText += `<br>Voc√™ teve ${errors} erros. Continue praticando!`; }
                }
                title.innerHTML = mTitle; text.innerHTML = mText; modal.classList.add('is-active');
            }

            window.closeCompletionModal = () => document.getElementById('completion-modal').classList.remove('is-active');
            window.handleRedoClick = () => { closeCompletionModal(); resetTabuada(currentTabuadaNum); }
            window.handleContinueClick = () => {
                closeCompletionModal();
                const nextTabuadaNum = currentTabuadaNum < 10 ? currentTabuadaNum + 1 : 1;
                if (currentTabuadaNum === 10) showOverallSummaryModal(); else showTabuada(nextTabuadaNum);
            }

            window.showOverallSummaryModal = () => { populateOverallSummary(); document.getElementById('overall-summary-modal').classList.add('is-active'); }
            window.closeOverallSummaryModal = () => document.getElementById('overall-summary-modal').classList.remove('is-active');
            
            function populateOverallSummary() {
                const contentDiv = document.getElementById('overall-summary-content');
                let html = `<h4>Desempenho por Divis√£o:</h4><ul>`;
                for (let i = 1; i <= 10; i++) { html += `<li>Divis√£o por ${i}: Acertos: ${tabuadaScores[i]}/10, Erros: ${tabuadaErrors[i]}</li>`; }
                html += `</ul><div class="summary-overall-totals">Total Geral de Acertos: ${calculateOverallScore()}/100 <br> Total Geral de Erros: ${calculateOverallErrors()}</div>`;
                contentDiv.innerHTML = html;
            }

            window.resetAllTabuadas = () => {
                if (!confirm('Tem certeza que deseja reiniciar TODAS as divis√µes?')) return;
                closeOverallSummaryModal();
                for (let i = 1; i <= 10; i++) {
                    tabuadaScores[i] = 0; tabuadaErrors[i] = 0;
                    tabuadaData[i].problems.forEach(p => { p.solved = false; p.userAnswer = null; });
                }
                totalOverallErrors = 0; totalOverallScore = 0;
                showTabuada(1);
            }
            
            renderTabNavigation();
            showTabuada(1);
        });
    </script>
</body>
</html>
